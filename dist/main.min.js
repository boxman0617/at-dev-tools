!function(window,angular,undefined){"use strict";function AtDevAlertBoxController($scope,AtDevExceptionService,$cookies,$filter){function displayDialog(){var from=dialogSettings.hideFrom;if(null!==from){from=new Date(from);var now=new Date;return from.setHours(from.getHours()+dialogSettings.hideFor),now>from?(dialogSettings.hideFor=0,dialogSettings.hideFrom=null,$cookies.putObject(DEV_COOKIE_KEY,dialogSettings),!0):($scope.showModal=!1,!1)}return!0}function parseHttpException(exception,cause){var e={exception:exception,cause:cause};return e.exception.stack=$filter("json")(exception.stack),e}function parseRegularException(exception,cause){var e={exception:exception,cause:cause};return e}function init(){var cookie=$cookies.getObject(DEV_COOKIE_KEY);"undefined"!=typeof cookie&&(dialogSettings=cookie),$scope.modalState[1]=dialogSettings.position,displayDialog()&&AtDevExceptionService.onException(function(exception,cause){exception instanceof AtHttpException?$scope.exceptions.push(parseHttpException.apply(null,arguments)):$scope.exceptions.push(parseRegularException.apply(null,arguments)),$scope.hasException=!0})}var DEV_OPEN="dev-open",DEV_CLOSE="dev-close",DEV_ICON_OPEN="fa-plus",DEV_ICON_CLOSE="fa-minus",DEV_COOKIE_KEY="devErrors",DEV_POSITION_BOTTOM_LEFT="bottom-left",DEV_POSITION_BOTTOM_RIGHT="bottom-right",DEV_POSITION_TOP_LEFT="top-left",DEV_POSITION_TOP_RIGHT="top-right",dialogSettings={position:DEV_POSITION_BOTTOM_LEFT,hideFor:0,hideFrom:null};$scope.hasException=!1,$scope.showModal=!0,$scope.exceptions=[],$scope.openIndex=0,$scope.askQuestion=!1,$scope.closeButtonIcon=[DEV_ICON_CLOSE],$scope.modalState=[DEV_OPEN,DEV_POSITION_BOTTOM_LEFT],$scope.optionsHours=[];for(var i=1;24>=i;i++)$scope.optionsHours.push(i);$scope.hours=$scope.optionsHours[0],$scope.exitModal=function(){$scope.openIndex=-1,$scope.askQuestion=!0},$scope.exitDialog=function(){dialogSettings.hideFor=parseInt($scope.hours),dialogSettings.hideFrom=new Date,$cookies.putObject(DEV_COOKIE_KEY,dialogSettings),$scope.showModal=!1},$scope.toggleModal=function(){$scope.modalState[0]===DEV_OPEN?($scope.modalState[0]=DEV_CLOSE,$scope.closeButtonIcon[0]=DEV_ICON_OPEN):($scope.modalState[0]=DEV_OPEN,$scope.closeButtonIcon[0]=DEV_ICON_CLOSE)},$scope.moveMin=function(){var currentPos=dialogSettings.position;switch(currentPos){case DEV_POSITION_BOTTOM_LEFT:dialogSettings.position=DEV_POSITION_TOP_LEFT;break;case DEV_POSITION_BOTTOM_RIGHT:dialogSettings.position=DEV_POSITION_BOTTOM_LEFT;break;case DEV_POSITION_TOP_LEFT:dialogSettings.position=DEV_POSITION_TOP_RIGHT;break;case DEV_POSITION_TOP_RIGHT:dialogSettings.position=DEV_POSITION_BOTTOM_RIGHT}$scope.modalState[1]=dialogSettings.position,$cookies.putObject(DEV_COOKIE_KEY,dialogSettings)},$scope.openException=function($index){$scope.openIndex===$index?$scope.openIndex=-1:$scope.openIndex=$index},init()}function AtDevAlertBoxDirective(){return{controller:["$scope","AtDevExceptionService","$cookies","$filter",AtDevAlertBoxController],template:'<div ng-show="hasException" ng-class="modalState" ng-if="showModal"><div class="dev-header">Errors! ({{exceptions.length}}) <div class="close-button" ng-click="toggleModal()"><i class="fa" ng-class="closeButtonIcon"></i></div><div class="move-button" ng-click="moveMin()"><i class="fa"></i></div><div class="exit-button" ng-click="exitModal()"><i class="fa fa-times"></i></div></div><div class="dev-question" ng-if="askQuestion">Do not show this dialog for: <div class="input-group"><select class="form-control input-sm" ng-model="hours" ng-options="hour for hour in optionsHours" ng-change="exitDialog()"></select><span class="input-group-addon">Hrs</span></div><button type="button" ng-click="exitDialog()" class="btn btn-danger btn-xs btn-block">Close</button></div><div class="dev-body"><div ng-repeat="exception in exceptions"><div class="title" ng-click="openException($index)">{{$index + 1}} - {{exception.cause}}</div><div class="info" ng-show="openIndex == $index"><div class="exception">Exception: {{exception.exception.message}}</div><div class="stack">Stack: <pre>{{exception.exception.stack}}</pre></div><div class="cause">Cause: {{exception.cause}}</div></div></div></div></div>'}}function AtDevExceptionHandler($provide){function init(){$provide.decorator("$exceptionHandler",["AtDevExceptionService","$delegate",AtDevExceptionHandlingDecorator])}init()}function AtDevExceptionHandlingDecorator(AtDevExceptionService,$delegate){return function(exception,cause){AtDevExceptionService.triggerExceptionHandling(exception,cause),$delegate(exception,cause)}}function AtDevExceptionService(){function onException(cb){onExceptionCallbacks.push(cb)}function triggerExceptionHandling(exception,cause){for(var i in onExceptionCallbacks)onExceptionCallbacks[i].apply(null,[exception,cause])}var onExceptionCallbacks=[];return{onException:onException,triggerExceptionHandling:triggerExceptionHandling}}function AtDevHttpErrorHandlingInterceptor($q,AtDevExceptionService){return{responseError:function(res){var deferred=$q.defer();return AtDevExceptionService.triggerExceptionHandling(new AtHttpException("["+res.status+"] "+res.config.url,res),"HTTP Exception ["+res.config.url+"] ("+res.status+")"),deferred.reject(res),deferred.promise}}}function AtEnvFactoryProvider(){this.ENVS={DEV:"DEV",PROD:"PROD"};var _env=this.ENVS.DEV;this.setEnv=function(env){_env=env},this.$get=[function(){return{_env:_env,is:function(){return this._env}}}]}function AtHttpException(message,res){this.message=message,this.stack=res}angular.module("atDev",[]).factory("AtDevExceptionService",[AtDevExceptionService]).factory("AtDevHttpErrorHandlingInterceptor",["$q","AtDevExceptionService",AtDevHttpErrorHandlingInterceptor]).provider("AtEnv",AtEnvFactoryProvider).directive("atDevAlertBox",[AtDevAlertBoxDirective]).config(["AtEnvProvider","$compileProvider",function(AtEnvProvider,$compileProvider){$compileProvider.debugInfoEnabled()||AtEnvProvider.setEnv(AtEnvProvider.ENVS.PROD)}]).config(["$provide",AtDevExceptionHandler]).config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push("AtDevHttpErrorHandlingInterceptor")}])}(window,window.angular);